# Ceph集群运维

------

[TOC]

## 操纵集群
### 用UPSTART控制CEPH
用ceph-deploy把Ceph Cuttlefish即更高版本部署到Ubuntu之后，可用基于事件的Upstart来启动，关闭Ceph节点上的守护进程。
列出Ceph作业和例程
`sudo initctl list | grep ceph`

启动所有守护进程
`sudo start ceph-all`

停止所有守护进程
`sudo stop ceph-all`

按类型启动/停止所有守护进程
```
sudo start/stop ceph-osd-all
sudo start/stop ceph-mon-all
sudo start/stop ceph-mds-all
```

启动/停止单个进程
```
sudo start/stop ceph-osd id={id}
sudo start/stop ceph-mon id={hostname}
sudo start/stop ceph-mds id={hostname}
```

### 运行CEPH
`{commandline} [options] [commands] [daemons]`

|选项|简写|描述|
|:-:|:-:|:-:|
|--verbose|-v|详细日志|
|--valgrind|N/A|用Valgrind调试|
|--allhosts|-a|在ceph.conf里配置的所有主机上执行，否则只在本机执行|
|--restart|N/A|核心转储后自动重启|
|--norestart|N/A|核心转储后不自动重启|
|--conf|-c|使用指定配置文件|

|命令|描述|
|:-:|:-:|
|start|启动守护进程|
|stop|停止守护进程|
|forcestop|暴力停止|
|killall|杀死某一类守护进程|
|cleanlogs|清理日志目录|
|cleanalllogs|清理日志目录内所有内容|

+ 通过SYSVINT机制运行CEPH
在CentOS，Redhat，Fedora和SLES发行版上可以通过sysvinit运行ceph

- 启动/停止所有守护进程
```
sudo /etc/init.d/ceph [iptions] [start|restart] [daemonType|daemonID]
sudo /etc/init.d/ceph -a start

sudo /etc/init.d/ceph [options] stop [daemonType|daemonID]
sudo /etc/init.d/ceph -a stop
```

- 启动/停止一类守护进程
```
启动本节点上某一类的所有Ceph守护进程
sudo /etc/init.d/ceph start/stop {daemon-type}
sudo /etc/init.d/ceph start/stop osd

启动费本机节点某一类的所有Ceph守护进程
sudo /etc/init.d/ceph -a start/stop {daemon-type}
sudo /etc/init.d/ceph -a start/stop osd
```

- 启动/停止单个守护进程
```
启动本节点上某个的Ceph守护进程
sudo /etc/init.d/ceph start/stop {daemon-type}.{instance}
sudo /etc/init.d/ceph start/stop osd.0

启动费本机节点某个的Ceph守护进程
sudo /etc/init.d/ceph -a start/stop {daemon-type}.{instance}
sudo /etc/init.d/ceph -a start/stop osd.0
```


## 监控集群
### 交互模式
```
ceph
ceph> health
ceph> status
ceph> quorum_status
ceph> mon_status
```

### 检查集群健康状态
```
ceph health

如果配置文件或密钥环不在默认路径下，需要指定
ceph -c /path/to/conf -k /path/to/keyring health
```

